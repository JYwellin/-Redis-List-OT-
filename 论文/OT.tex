\documentclass[a4paper,UTF8]{article}
\usepackage{ctex}
\usepackage[margin=1.25in]{geometry}
\usepackage{amsmath}



\begin{document}
\title{面向Redis List的OT函数的设计、验证与实现}
\author{141220044, 纪业}
\maketitle


\section{绪言}
\subsection{应用背景：协同编辑应用}
	协同编辑系统，可以允许不同地点的用户同时编辑同一份文档。为了获得较快的响应和较高的实用性，系统会在不同的地点或设备进行文档的复制。一个用户可以在某个副本上进行文档的编辑，并将做出的修改异步地传递给其他副本。不必要等待服务器处理完再响应用户操作，本地操作可以立即执行。同时系统必须保证编辑的一致性，即在所有用户完成文档的编辑后，所有的副本内容一致。
\subsection{技术背景：Replicated List 规约及其基于OT的 Replicated List 算法}
\subsection{相关工作及其不足}
	可以设计OT函数，并通过控制算法的调用来保证最终结果的一致性，现在ins,del,set等简单operation的OT函数已经基本实现。
\subsection{本文研究工作: 面向 Redis List  的OT函数的设计、验证与实现}
	本次毕业设计的目标是实现Redis List所支持的14种非阻塞操作的OT函数，并且对实现函数的正确性进行验证。阿里云和RedisLab的团队目前都在对Redis List的操作进行开发，Redis List操作的OT函数实现具有应用前景和商业前途。
	
\section{Redis List OT 函数设计}
\subsection{Redis List API 分类：根据“Effects” 分为三类}
单个元素的删除、修改、插入：$ Insert(pos,ele),delete(pos),set(pos,ele),$\\
                      $ (Lpush(ele), Lpushx),(Rpush(ele), Rpushx),Lpop, Rpop$\\

单个区间的删除、插入：$Ins(pos,str),Del(pos,len)$\\

多个区间的删除：$Rem(pos1,len1;pos2,len2;...;posk,lenk),Trim(pos1,pos2)$\\
而$Trim$操作可以转换为$Rem(0,pos1-1;pos2+1,len-pos2-1)$\\

\subsection{第一类 OT 函数的设计}
\begin{equation}
\begin{aligned}
Lpush\begin{cases}
 OT(Lpush(x),Lpush(y))={Lpush(x)} \\
 OT(Lpush(x),Rpush(y))= {Lpush(x)} \\
OT(Lpush(x),Lpop)=
{Lpush(x)}\\
OT(Lpush(x),Rpop)=
{Lpush(x)}\\
OT(Lpush(x),Set(i,y))=
{Lpush(x)}\\
OT(Lpush(x),Ins(i,y))=
{Lpush(x)}\\
OT(Lpush(x),Del(i))=
{Lpush(x)} \end{cases}\\
\end{aligned}
\end{equation}


\begin{equation}
\begin{aligned}
Rpush \begin{cases}
OT(Rpush(x),Lpush(y))=
{Rpush(x)}\\
OT(Rpush(x),Rpush(y))=
{Rpush(x)}\\
OT(Rpush(x),Lpop)=
{Rpush(x)}\\
OT(Rpush(x),Rpop)=
{Rpush(x)}\\
OT(Rpush(x),Set(i,y))=
{Rpush(x)}\\
OT(Rpush(x),Ins(i,y))=
{Rpush(x)}\\
OT(Rpush(x),Del(i))=
{Rpush(x)} \end{cases}\\
\end{aligned}
\end{equation}


\begin{equation}
\begin{aligned}
Lpop \begin{cases}
OT(Lpop,Lpush(x))={Del(1)}\\
OT(Lpop,Rpush(x))={Lpop}\\
OT(Lpop,Lpop)=
{no-op} \\
OT(Lpop,Rpop)=
{Lpop} \\
OT(Lpop,Set(i,x))=
{Lpop}\\
OT(Lpop,Ins(i,x))=\begin{cases}
{Del(1)} \quad i=0\\
{Lpop}  \quad i \neq 0 \end{cases}\\
OT(Lpop,Del(i))=n\begin{cases}
{no-op} \quad i=0\\
{Lpop} \quad i\neq 0\\\end{cases}
\end{cases}
\end{aligned}
\end{equation}


\begin{equation}
\begin{aligned}
Rpop \begin{cases}
OT(Rpop,Lpush(x))={Rpop}\\
OT(Rpop,Rpush(x))={Del(-2)}\\
OT(Rpop,Lpop)=
{Rpop}\\
OT(Rpop,Rpop)=
{no-op}\\
OT(Rpop,Set(i,x))=
{Rpop}\\
OT(Rpop,Ins(i,x))=\begin{cases}
{Del(-2)}  \quad i=len-1\\
{Rpop} \quad  i \neq len-1\end{cases}\\
OT(Rpop,Del(i))=\begin{cases}
{no-op}  \quad i=len-1\\
{Rpop}  \quad i \neq len-1\\\end{cases}
\end{cases}
\end{aligned}
\end{equation}


\begin{equation}
\begin{aligned}
Set \begin{cases}
OT(Set(i,x),Lpush(y))=
{Set(i+1,x)}\\
OT(Set(i,x),Rpush(y))=
{Set(i,x)}\\
OT(Set(i,x),Lpop)=\begin{cases}
{no-op} \quad i=0\\
{Set(i-1,x)} \quad i \neq 0 \end{cases}\\
OT(Set(i,x),Rpop)= \begin{cases}
{no-op} \quad i=-1\\
{Set(i,x)} \quad i \neq -1 \end{cases} \\
OT(set (i,x), set (j,y)) =
	{set (i,x)}\\
OT(Set(i,x),Ins(j,y))=\begin{cases}
{Set(i,x)}  \quad i<j\\
{Set(i+1,x)} \quad  i=j \\
{Set(i+1,x)} \quad  i>j \end{cases} \\
OT(Set(i,x),Del(j))=\begin{cases}
{Set(i,x)} \quad i<j\\
{no-op} \quad  i=j\\
{Set(i-1,x)} \quad i>j \end{cases} \\
\end{cases}
\end{aligned}
\end{equation}


\begin{equation}
\begin{aligned}
Ins \begin{cases}
OT(Ins(i,x),Lpush(y))=
{Ins(i+1,x)} \\
OT(Ins(i,x),Rpush(y))=
{Ins(i,x)}\\
OT(Ins(i,x),Lpop)=\begin{cases}
{Ins(i,x)}  \quad i=0\\
{Ins(i-1,x)}  \quad i \neq 0 \end{cases}\\
OT(Ins(i,x),Rpop)=\begin{cases}
{Ins(i-1,x)} \quad i=-1\\
{Ins(i,x)}  \quad i \neq -1 \end{cases} \\
OT(Ins(i,x), set (j,y)) =
{Ins(i,x)}\\
OT(ins (i,x), ins (j,y)) =\begin{cases}
	{ins(i+1, x)}   \quad i > j\\
	{ins(i, x)}    \quad i < j\\
	{ins(i, x)}   \quad  i = j \end{cases} \\
OT(Ins(i,x),Del(j))=\begin{cases}
{Ins(i,x)}  \quad i<j\\
{Ins(i,x)} \quad i=j\\
{Ins(i-1,x)} \quad i>j \end{cases}\\
\end{cases}
\end{aligned}
\end{equation}


\begin{equation}
\begin{aligned}
Del \begin{cases}
OT(Del (i),Lpush(y))=
{Del(i+1)} \\
OT(Del (i),Rpush(y))=
{Del (i)}\\
OT(Del (i),Lpop)=\begin{cases}
{no-op} \quad i=0\\
{Del(i-1)} \quad i!=0 \end{cases}\\
OT(Del (i),Rpop)=\begin{cases}
{no-op} \quad i=-1\\
{Del(i)} \quad i \neq -1 \end{cases}\\
OT(del (i), set (j,x)) =
	{del(i)}\\
OT(del (i), ins (j,x)) =\begin{cases}
	{del (i+1)}  \quad i > j\\
	{del i}   \quad i < j\\
	{del (i+1)}  \quad i = j \end{cases}\\
OT(del (i), del (j)) =\begin{cases}
	{del (i-1)} \quad i > j\\
	{del (i)} \quad i < j\\
	{no-op}   \quad i = j \end{cases}\\
\end{cases}
\end{aligned}
\end{equation}

\subsection{第二类 OT 函数设计}
\begin{equation}
OT(Ins(p1,s1),Ins(p1,s2))= \begin{cases}
Ins(p1,s1) \quad & p1<p2 \\
Ins(p1+ |s2|,s1) \quad & p1=p2\\
Ins(p1+ |s2|,s1) \quad & p1>p2 \end{cases}\\
\end{equation}

\begin{equation}
OT(Ins(p1,s1),Del(p2,l1))= \begin{cases}
Ins(p1,s1) \quad & p1 \le p2 \\
no-op \quad & p2<p1<p2+l1\\
Ins(p1-l1,s1) \quad & p1 \ge p2+l1 \end{cases}\\
\end{equation}

\begin{equation}
OT(Del(p1,l1),Ins(p2,s1))= \begin{cases}
Del(p1,l1) \quad & p1 + l1 \le p2 \\
Del(p1,l1+|s1|) \quad & p1<p2<p1+l1 \\
Ins(p1+ |s1|,l1) \quad & p1 \ge p2 \end{cases}\\
\end{equation}

\begin{equation}
OT(Del(p1,l1),Del(p2,l2))= \begin{cases}
Del(p1,l1) \quad & p1+l1 \le p2 \\
Del(p1-l2,s1) \quad & p1 \ge p2+l2 \\
Del(p1,p2-p1) \quad & p1<p2<p1+l1 \le p2+l2\\
Del(p2,p1+l1-p2-l2) \quad & p2 \le p1 <p2+l2 < p1+l1\\
Del(p1,l1-l2) \quad & p1 \le p2 <p2+l2 < p1+l1\\
no-op \quad & else \end{cases}\\
\end{equation}
\subsection{第三类 OT 函数设计}

$OT(Ins(p_{k+1},s_{k+1}),Del(p_1,l_1;p_2,l_2;...;p_k,l_k))$\\
\begin{equation}
= \begin{cases}
Ins(p_{k+1},s_{k+1}) \quad & p_{k+1} \le p_1 \\
no-op \quad & p_i<p_{k+1}<p_i+l_i\\
Ins(p_{k+1}-l_1-l_2-...-l_i,s_{k+1}) \quad & p_i+l_i \le p_{k+1} \le p_{i+1}\\
Ins(p_{k+1}-l_1-l_2-...-l_i,s_{k+1}) \quad & p_{k+1} \ge pk+|sk| \end{cases}\\
\end{equation}

$OT(Del(p_1,l_1;p_2,l_2;...;p_k,l_k),Ins(p_{k+1},s_{k+1}))$\\
\begin{equation}
= \begin{cases}
Del(p_1,l_1;p_2,l_2;...;p_k,l_k) &\quad P_k+l_k \le p_{k+1} \\
Del(p_1,l_1;p_2,l_2;...;p_{i-1},l_{i-1};p_i,l_i+|s_{k+1}|;p_{i+1}+|s_{k+1}|,l_{i+1};...;p_k+|s_{k+1}|,l_k) &\quad p_i<p_{k+1} \le pi+li \\
Del(p_1,l_1;p_2,l_2;...;p_i,l_i;p_{i+1}+|s_{k+1}|,l_{i+1};...;p_k+|s_{k+1}|,l_k) & \quad p_i+l_i < p_{k+1} \le p_{i+1}\\
 \end{cases}\\
\end{equation}

$OT(Del(p_{k+1},s_{k+1}),Del(p_1,l_1;p_2,l_2;...;p_k,l_k))$\\
\begin{equation}
= \begin{cases}
Del(p_{k+1},s_{k+1}) \quad p_{k+1} < p_1 \quad &p_{k+1}+l_{k+1} \le p_1 \\
Del(p_{k+1},s_{k+1}) \quad p_{k+1} < p_1 \quad &p_j < p_{k+1}+l_{k+1} \le p_j+l_j \\
Del(p_{k+1},s_{k+1}) \quad p_{k+1} < p_1 \quad &p_j+l_j < p_{k+1}+l_{k+1} \le p_{j+1} \\
Del(p_{k+1},s_{k+1}) \quad p_{k+1} < p_1 \quad &p_{k+1}+l_{k+1} > P_k+l_k  \\

Del(p_i-l_1-l_2-...-l_{i-1},p_j-p_i-l_i-l_{i+1}...-l_{j-1})        \quad &p_i \le p_{k+1} < p_i+l_i \quad \\ &p_j < p_{k+1}+l_{k+1} \le p_j+l_j \\
Del(p_i-l_1-l_2-...-l_{i-1},p_{k+1}+l_{k+1}-p_i-l_i-l_{i+1}-...-l_j) \quad &p_i \le p_{k+1} < p_i+l_i \quad \\& p_j+l_j < p_{k+1}+l_{k+1} \le p_{j+1} \\
Del(p_i-l_1-l_2-...-l_{i-1},p_{k+1}+l_{k+1}-p_i-l_i-l_{i+1}-...-l_k) \quad &p_i \le p_{k+1} < p_i+l_i \quad \\& p_{k+1}+l_{k+1} > P_k+l_k  \\


Del(p_{k+1}-l_1-l_2-...-l_{i-1},p_{k+1}-p_j-l_{i+1}-l_{i+2}-...-l_{j-1})    \quad &p_i+l_i \le p_{k+1} < p_{i+1} \quad \\& p_j < p_{k+1}+l_{k+1} \le p_j+l_j \\
Del(p_{k+1}-l_1-l_2-...-l_{i-1},l_{i+1}-l_{i+1}-l_{i+2}-...-l_j)    \quad &p_i+l_i \le p_{k+1} < p_{i+1} \quad \\& p_j+l_j < p_{k+1}+l_{k+1} \le p_{j+1} \\
Del(p_{k+1}-l_1-l_2-...-l_{i-1},l_{i+1}-l_{i+1}-l_{i+2}-...-l_k)    \quad &p_i+l_i \le p_{k+1} < p_{i+1} \quad \\& p_{k+1}+l_{k+1} > P_k+l_k  \\

Del(p_{k+1}-p_1-p_2...-p_k,l_{k+1}) \quad &p_{k+1} \ge p_k+l_k
\\&(i \ge j)

 \end{cases}\\
\end{equation}

\section{基于 TLA+ 的 OT函数验证} 



\section{Redis List OT 函数实现} 


\end{document}
